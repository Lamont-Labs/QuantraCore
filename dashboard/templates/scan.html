{% extends "base.html" %}
{% block title %}Scan - QuantraCore Apex{% endblock %}

{% block content %}
<h1 style="margin-bottom: 20px;">Symbol Scanner</h1>

<div class="card">
    <div class="card-header">Scan Symbol</div>
    <form action="/scan" method="post">
        <div class="grid grid-3">
            <div class="form-group">
                <label for="symbol">Symbol</label>
                <input type="text" id="symbol" name="symbol" placeholder="AAPL" value="{{ symbol or '' }}" required>
            </div>
            <div class="form-group">
                <label for="period">Period</label>
                <select id="period" name="period">
                    <option value="1y">1 Year</option>
                    <option value="6m">6 Months</option>
                    <option value="3m">3 Months</option>
                </select>
            </div>
            <div class="form-group" style="display: flex; align-items: flex-end;">
                <button type="submit" class="btn btn-primary" style="width: 100%;">Run Scan</button>
            </div>
        </div>
    </form>
</div>

{% if result %}
<div class="grid grid-2">
    <div class="card">
        <div class="card-header">{{ result.symbol }} — Analysis Results</div>
        
        <div style="text-align: center; padding: 20px;">
            <div style="font-size: 3rem; font-weight: 700;" class="{% if result.score >= 60 %}score-high{% elif result.score >= 45 %}score-mid{% else %}score-low{% endif %}">
                {{ "%.1f"|format(result.score) }}
            </div>
            <div style="color: var(--text-muted); margin-top: 5px;">QuantraScore</div>
        </div>
        
        <div class="detail-row">
            <span class="detail-label">Regime</span>
            <span class="regime regime-{{ result.regime }}">{{ result.regime }}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Risk Tier</span>
            <span class="risk-{{ result.risk }}">{{ result.risk }}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Entropy State</span>
            <span class="detail-value">{{ result.entropy }}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Candles Analyzed</span>
            <span class="detail-value">{{ result.num_candles }}</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Window Hash</span>
            <span class="detail-value" style="font-family: monospace; font-size: 0.8rem;">{{ result.window_hash[:16] }}...</span>
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">Fired Protocols ({{ result.protocols|length }})</div>
        <div style="padding: 10px 0;">
            {% for p in result.protocols %}
            <span class="protocol-tag">{{ p }}</span>
            {% endfor %}
            {% if not result.protocols %}
            <span style="color: var(--text-muted);">No protocols fired</span>
            {% endif %}
        </div>
        
        <div class="card-header" style="margin-top: 20px;">Signal Assessment</div>
        {% if result.score >= 70 %}
        <div style="color: var(--green); padding: 10px 0;">
            <strong>HIGH CONVICTION</strong> — Strong structural signal detected
        </div>
        {% elif result.score >= 60 %}
        <div style="color: var(--yellow); padding: 10px 0;">
            <strong>MODERATE CONVICTION</strong> — Favorable structural alignment
        </div>
        {% elif result.score >= 45 %}
        <div style="color: var(--text-muted); padding: 10px 0;">
            <strong>NEUTRAL</strong> — Insufficient conviction for signal
        </div>
        {% else %}
        <div style="color: var(--red); padding: 10px 0;">
            <strong>CAUTIONARY</strong> — Structural concerns detected
        </div>
        {% endif %}
    </div>
</div>
{% endif %}

{% if error %}
<div class="card" style="border-color: var(--red);">
    <div style="color: var(--red);">Error: {{ error }}</div>
</div>
{% endif %}
{% endblock %}
